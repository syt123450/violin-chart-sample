!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("chart.js")):"function"==typeof define&&define.amd?define(["exports","chart.js"],e):e(t.ChartBoxPlot=t.ChartBoxPlot||{},t.Chart)}(this,function(t,e){"use strict";var i=function(t,e){return t<e?-1:t>e?1:t>=e?0:NaN};var r,n;1===(r=i).length&&(n=r,r=function(t,e){return i(n(t),e)});var a=function(t){return null===t?NaN:+t},o=function(t,e){var i,r,n,a=t.length,o=-1;if(null==e){for(;++o<a;)if(null!=(i=t[o])&&i>=i)for(r=n=i;++o<a;)null!=(i=t[o])&&(r>i&&(r=i),n<i&&(n=i))}else for(;++o<a;)if(null!=(i=e(t[o],o,t))&&i>=i)for(r=n=i;++o<a;)null!=(i=e(t[o],o,t))&&(r>i&&(r=i),n<i&&(n=i));return[r,n]};Math.sqrt(50),Math.sqrt(10),Math.sqrt(2);var l=function(t,e,i){if(null==i&&(i=a),r=t.length){if((e=+e)<=0||r<2)return+i(t[0],0,t);if(e>=1)return+i(t[r-1],r-1,t);var r,n=(r-1)*e,o=Math.floor(n),l=+i(t[o],o,t);return l+(+i(t[o+1],o+1,t)-l)*(n-o)}};function s(t){return 1/Math.sqrt(2*Math.PI)*Math.exp(-.5*t*t)}function u(t,e){return t-e}function h(t){var e,i,r,n=(i=[.25,.75],r=(e=(e=t).slice().sort(u)).length-1,i.map(function(t){if(0===t)return e[0];if(1===t)return e[r];var i=1+t*r,n=Math.floor(i),a=i-n,o=e[n-1];return 0===a?o:o+a*(e[n]-o)}));return n[1]-n[0]}function m(t){var e=h(t)/1.34;return 1.06*Math.min(Math.sqrt(function(t){var e=t.length;if(e<1)return NaN;if(1===e)return 0;for(var i=function(t){var e=t.length;if(0===e)return NaN;for(var i=0,r=-1;++r<e;)i+=(t[r]-i)/(r+1);return i}(t),r=-1,n=0;++r<e;){var a=t[r]-i;n+=a*a}return n/(e-1)}(t)),e)*Math.pow(t.length,-.2)}function c(t){var e=t.q3-t.q1;return{whiskerMin:Math.max(t.min,t.q1-e),whiskerMax:Math.min(t.max,t.q3+e)}}function f(t){if(0===t.length)return{outliers:[]};(t=t.filter(function(t){return"number"==typeof t&&!isNaN(t)})).sort(function(t,e){return t-e});var e=o(t);return{min:e[0],max:e[1],median:l(t,.5),kde:function(){var t=s,e=[],i=m;function r(r,n){var a=i.call(this,e);return r.map(function(i){for(var r=-1,n=0,o=e.length;++r<o;)n+=t((i-e[r])/a);return[i,n/a/o]})}return r.kernel=function(e){return arguments.length?(t=e,r):t},r.sample=function(t){return arguments.length?(e=t,r):e},r.bandwidth=function(t){return arguments.length?(i="function"==typeof(e=t)?e:function(){return e},r):i;var e},r}().sample(t)}}function d(t){if(!t)return null;if("number"==typeof t.median&&"number"==typeof t.q1&&"number"==typeof t.q3){if(void 0===t.whiskerMin){var e=c(t),i=e.whiskerMin,r=e.whiskerMax;t.whiskerMin=i,t.whiskerMax=r}return t}return Array.isArray(t)?(void 0===t.__stats&&(t.__stats=function(t){if(0===t.length)return{min:NaN,max:NaN,median:NaN,q1:NaN,q3:NaN,whiskerMin:NaN,whiskerMax:NaN,outliers:[]};(t=t.filter(function(t){return"number"==typeof t&&!isNaN(t)})).sort(function(t,e){return t-e});var e=o(t),i={min:e[0],max:e[1],median:l(t,.5),q1:l(t,.25),q3:l(t,.75),outliers:[]},r=c(i),n=r.whiskerMin,a=r.whiskerMax;return i.outliers=t.filter(function(t){return t<n||t>a}),i.whiskerMin=n,i.whiskerMax=a,i}(t)),t.__stats):void 0}function v(t){if(!t)return t;if("number"==typeof t||"string"==typeof t)return Number(t);var e=d(t);return e?e.median:t}function x(t){var e=this,i=this.chart,r=this.isHorizontal();this.min=null,this.max=null,i.data.datasets.forEach(function(n,a){var o,l=i.getDatasetMeta(a);i.isDatasetVisible(a)&&(o=l,r?o.xAxisID===e.id:o.yAxisID===e.id)&&n.data.forEach(function(i,r){if(i&&!l.data[r].hidden){var n,a="number"==typeof(n=i).min&&"number"==typeof n.max?n:Array.isArray(n)?d(n):void 0;a&&(null===e.min?e.min=a.min:a.min<e.min&&(e.min=a.min),null===e.max?e.max=a.max:a.max>e.max&&(e.max=a.max),t&&t(a))}})})}function g(t,e){if(null===e||!e||0===e)return t;var i=void 0;return(i=e>1?t-Math.abs(e):t-t*Math.abs(e))<0?0:i}var p=Object.assign({},e.defaults.global.elements.rectangle,{borderWidth:1,outlierRadius:2,outlierColor:e.defaults.global.elements.rectangle.backgroundColor,itemRadius:2,itemStyle:"circle",itemBackgroundColor:e.defaults.global.elements.rectangle.backgroundColor,itemBorderColor:e.defaults.global.elements.rectangle.borderColor}),b=e.Element.extend({isVertical:function(){return void 0!==this._view.width},draw:function(){},_drawItems:function(t,i,r,n){if(!(t.itemRadius<=0||!i.items||i.items.length<=0)){r.save(),r.strokeStle=t.itemBorderColor,r.fillStyle=t.itemBackgroundColor;var a,o=(void 0===(a=i.median)&&(a=Date.now()),function(){return(a=(9301*a+49297)%233280)/233280}),l=t.itemRadius;if(n){var s=t.x,u=g(t.width,t.padding);i.items.forEach(function(i){e.canvasHelpers.drawPoint(r,t.itemStyle,l,s-u/2+o()*u,i)})}else{var h=t.y,m=g(t.height,t.padding);i.items.forEach(function(i){e.canvasHelpers.drawPoint(r,t.itemStyle,l,i,h-m/2+o()*m)})}r.restore()}},_drawOutliers:function(t,e,i,r){if(e.outliers){var n=t.outlierRadius;if(i.fillStyle=t.outlierColor,i.beginPath(),r){var a=t.x;e.outliers.forEach(function(t){i.arc(a,t,n,0,2*Math.PI)})}else{var o=t.y;e.outliers.forEach(function(t){i.arc(t,o,n,0,2*Math.PI)})}i.fill(),i.closePath()}},_getBounds:function(){return{left:0,top:0,right:0,bottom:0}},height:function(){return 0},inRange:function(t,e){if(!this._view)return!1;var i=this._getBounds();return t>=i.left&&t<=i.right&&e>=i.top&&e<=i.bottom},inLabelRange:function(t,e){if(!this._view)return!1;var i=this._getBounds();return this.isVertical()?t>=i.left&&t<=i.right:e>=i.top&&e<=i.bottom},inXRange:function(t){var e=this._getBounds();return t>=e.left&&t<=e.right},inYRange:function(t){var e=this._getBounds();return t>=e.top&&t<=e.bottom},getCenterPoint:function(){var t=this._view;return{x:t.x,y:t.y}},getArea:function(){return 0},tooltipPosition_:function(){return this.getCenterPoint()}});e.defaults.global.elements.boxandwhiskers=Object.assign({},p);var y=e.elements.BoxAndWhiskers=b.extend({draw:function(){var t=this._chart.ctx,e=this._view,i=e.boxplot,r=this.isVertical();this._drawItems(e,i,t,r),t.save(),t.fillStyle=e.backgroundColor,t.strokeStyle=e.borderColor,t.lineWidth=e.borderWidth,this._drawBoxPlot(e,i,t,r),this._drawOutliers(e,i,t,r),t.restore()},_drawBoxPlot:function(t,e,i,r){if(i.beginPath(),r){var n=t.x,a=g(t.width,t.padding),o=n-a/2;i.fillRect(o,e.q1,a,e.q3-e.q1),i.strokeRect(o,e.q1,a,e.q3-e.q1),i.moveTo(o,e.whiskerMin),i.lineTo(o+a,e.whiskerMin),i.moveTo(n,e.whiskerMin),i.lineTo(n,e.q1),i.moveTo(o,e.whiskerMax),i.lineTo(o+a,e.whiskerMax),i.moveTo(n,e.whiskerMax),i.lineTo(n,e.q3),i.moveTo(o,e.median),i.lineTo(o+a,e.median)}else{var l=t.y,s=g(t.height,t.padding),u=l-s/2;i.fillRect(e.q1,u,e.q3-e.q1,s),i.strokeRect(e.q1,u,e.q3-e.q1,s),i.moveTo(e.whiskerMin,u),i.lineTo(e.whiskerMin,u+s),i.moveTo(e.whiskerMin,l),i.lineTo(e.q1,l),i.moveTo(e.whiskerMax,u),i.lineTo(e.whiskerMax,u+s),i.moveTo(e.whiskerMax,l),i.lineTo(e.q3,l),i.moveTo(e.median,u),i.lineTo(e.median,u+s)}i.stroke(),i.closePath()},_getBounds:function(){var t=this._view,e=this.isVertical(),i=t.boxplot;if(!i)return{left:0,top:0,right:0,bottom:0};if(e){var r=t.x,n=t.width,a=r-n/2;return{left:a,top:i.whiskerMax,right:a+n,bottom:i.whiskerMin}}var o=t.y,l=t.height,s=o-l/2;return{left:i.whiskerMin,top:s,right:i.whiskerMax,bottom:s+l}},height:function(){var t=this._view;return t.base-Math.min(t.boxplot.q1,t.boxplot.q3)},getArea:function(){var t=this._view,e=Math.abs(t.boxplot.q3-t.boxplot.q1);return this.isVertical()?e*t.width:e*t.height}});e.defaults.global.elements.violin=Object.assign({points:100},p);var w=e.elements.Violin=b.extend({draw:function(){var t=this._chart.ctx,i=this._view,r=i.violin,n=this.isVertical();this._drawItems(i,r,t,n),t.save(),t.fillStyle=i.backgroundColor,t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth;var a=r.coords;if(e.canvasHelpers.drawPoint(t,"rectRot",5,i.x,i.y),t.stroke(),t.beginPath(),n){var o=i.x,l=g(i.width,i.padding)/2/r.maxEstimate;t.moveTo(o,r.min),a.forEach(function(e){var i=e.v,r=e.estimate;t.lineTo(o-r*l,i)}),t.lineTo(o,r.max),t.moveTo(o,r.min),a.forEach(function(e){var i=e.v,r=e.estimate;t.lineTo(o+r*l,i)}),t.lineTo(o,r.max)}else{var s=i.y,u=g(i.height,i.padding)/2/r.maxEstimate;t.moveTo(r.min,s),a.forEach(function(e){var i=e.v,r=e.estimate;t.lineTo(i,s-r*u)}),t.lineTo(r.max,s),t.moveTo(r.min,s),a.forEach(function(e){var i=e.v,r=e.estimate;t.lineTo(i,s+r*u)}),t.lineTo(r.max,s)}t.stroke(),t.fill(),t.closePath(),this._drawOutliers(i,r,t,n),t.restore()},_getBounds:function(){var t=this._view,e=this.isVertical(),i=t.violin;if(e){var r=t.x,n=t.width,a=r-n/2;return{left:a,top:i.max,right:a+n,bottom:i.min}}var o=t.y,l=t.height,s=o-l/2;return{left:i.min,top:s,right:i.max,bottom:s+l}},height:function(){var t=this._view;return t.base-Math.min(t.violin.min,t.violin.max)},getArea:function(){var t=this._view,e=Math.abs(t.violin.max-t.violin.min);return this.isVertical()?e*t.width:e*t.height}}),M={scales:{yAxes:[{type:"arrayLinear"}]}},k={scales:{xAxes:[{type:"arrayLinear"}]}},_={_elementOptions:function(){return{}},updateElement:function(t,i,r){var n=this.getDataset(),a=t.custom||{},o=this._elementOptions();e.controllers.bar.prototype.updateElement.call(this,t,i,r),["outlierRadius","itemRadius","itemStyle","itemBackgroundColor","itemBorderColor","outlierColor","padding"].forEach(function(r){t._model[r]=void 0!==a[r]?a[r]:e.helpers.valueAtIndexOrDefault(n[r],i,o[r])})},_calculateCommonModel:function(t,e,i,r){i.outliers&&(t.outliers=i.outliers.map(function(t){return r.getPixelForValue(Number(t))})),Array.isArray(e)&&(t.items=e.map(function(t){return r.getPixelForValue(Number(t))}))}},q={tooltips:{callbacks:{label:function(t,e){var i=e.datasets[t.datasetIndex].label||"",r=d(e.datasets[t.datasetIndex].data[t.index]),n=i+" "+("string"==typeof t.xLabel?t.xLabel:t.yLabel);return r?n+" (min: "+r.min+", q1: "+r.q1+", median: "+r.median+", q3: "+r.q3+", max: "+r.max+")":n+"NaN"}}}};e.defaults.boxplot=e.helpers.merge({},[e.defaults.bar,M,q]),e.defaults.horizontalBoxplot=e.helpers.merge({},[e.defaults.horizontalBar,k,q]);var T=Object.assign({},_,{dataElementType:e.elements.BoxAndWhiskers,_elementOptions:function(){return this.chart.options.elements.boxandwhiskers},updateElementGeometry:function(t,i,r){e.controllers.bar.prototype.updateElementGeometry.call(this,t,i,r),t._model.boxplot=this._calculateBoxPlotValuesPixels(this.index,i)},_calculateBoxPlotValuesPixels:function(t,e){var i=this.getValueScale(),r=this.chart.data.datasets[t].data[e];if(!r)return null;var n=d(r),a={};return Object.keys(n).forEach(function(t){"outliers"!==t&&(a[t]=i.getPixelForValue(Number(n[t])))}),this._calculateCommonModel(a,r,n,i),a}}),N=e.controllers.boxplot=e.controllers.bar.extend(T),P=e.controllers.horizontalBoxplot=e.controllers.horizontalBar.extend(T),V={};e.defaults.violin=e.helpers.merge({},[e.defaults.bar,M,V]),e.defaults.horizontalViolin=e.helpers.merge({},[e.defaults.horizontalBar,k,V]);var B=Object.assign({},_,{dataElementType:e.elements.Violin,_elementOptions:function(){return this.chart.options.elements.violin},updateElementGeometry:function(t,i,r){e.controllers.bar.prototype.updateElementGeometry.call(this,t,i,r);var n=t.custom||{},a=this._elementOptions();t._model.violin=this._calculateViolinValuesPixels(this.index,i,void 0!==n.points?n.points:a.points)},_calculateViolinValuesPixels:function(t,e,i){var r,n=this.getValueScale(),a=this.chart.data.datasets[t].data[e],o=(r=a)?"number"!=typeof r.median||"function"!=typeof r.kde&&!Array.isArray(r.coords)?Array.isArray(r)?(void 0===r.__kde&&(r.__kde=f(r)),r.__kde):void 0:r:null,l=o.max-o.min,s=function(t,e,i){t=+t,e=+e,i=(n=arguments.length)<2?(e=t,t=0,1):n<3?1:+i;for(var r=-1,n=0|Math.max(0,Math.ceil((e-t)/i)),a=new Array(n);++r<n;)a[r]=t+r*i;return a}(o.min,o.max,l/i);s[s.length-1]!==o.max&&s.push(o.max);var u=o.coords||o.kde(s).map(function(t){return{v:t[0],estimate:t[1]}}),h={min:n.getPixelForValue(o.min),max:n.getPixelForValue(o.max),median:n.getPixelForValue(o.median),coords:u.map(function(t){var e=t.v,i=t.estimate;return{v:n.getPixelForValue(e),estimate:i}}),maxEstimate:function(t,e){var i,r,n=t.length,a=-1;if(null==e){for(;++a<n;)if(null!=(i=t[a])&&i>=i)for(r=i;++a<n;)null!=(i=t[a])&&i>r&&(r=i)}else for(;++a<n;)if(null!=(i=e(t[a],a,t))&&i>=i)for(r=i;++a<n;)null!=(i=e(t[a],a,t))&&i>r&&(r=i);return r}(u,function(t){return t.estimate})};return this._calculateCommonModel(h,a,o,n),h}}),S=(e.controllers.violin=e.controllers.bar.extend(B),e.controllers.horizontalViolin=e.controllers.horizontalBar.extend(B)),C=e.scaleService.getScaleConstructor("linear").extend({getRightValue:function(t){return e.LinearScaleBase.prototype.getRightValue.call(this,v(t))},determineDataLimits:function(){x.call(this),this.handleTickRangeOptions()}});e.scaleService.registerScaleType("arrayLinear",C,e.scaleService.getScaleDefaults("linear"));var A=e.helpers,E=e.scaleService.getScaleConstructor("logarithmic").extend({getRightValue:function(t){return e.LinearScaleBase.prototype.getRightValue.call(this,v(t))},determineDataLimits:function(){var t=this;this.minNotZero=null,x.call(this,function(e){0!==e.min&&(null===t.minNotZero||e.min<t.minNotZero)&&(t.minNotZero=e.min)});var e=this.options.ticks;this.min=A.valueOrDefault(e.min,this.min-.05*this.min),this.max=A.valueOrDefault(e.max,this.max+.05*this.max),this.min===this.max&&(0!==this.min&&null!==this.min?(this.min=Math.pow(10,Math.floor(A.log10(this.min))-1),this.max=Math.pow(10,Math.floor(A.log10(this.max))+1)):(this.min=1,this.max=10))}});e.scaleService.registerScaleType("arrayLogarithmic",E,e.scaleService.getScaleDefaults("logarithmic")),t.BoxAndWhiskers=y,t.Violin=w,t.ArrayLinearScale=C,t.ArrayLogarithmicScale=E,t.BoxPlot=N,t.HorizontalBoxPlot=P,t.HorizontalViolin=S,Object.defineProperty(t,"__esModule",{value:!0})});